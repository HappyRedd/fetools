(function(){var weixin=(function(){function WeiXin(){this.__private__={readyArr:[],isInited:false};WeiXin._init.apply(this)}WeiXin._init=function(){var that=this;var readyHandler=function(){window.oldInvoke=WeixinJSBridge.invoke;WeixinJSBridge.invoke=function(type,options,cbFn){try{var typeFilter=["shareTimeline","sendAppMessage","shareWeibo"].join();if(typeFilter.indexOf(type)===-1||!that.__private__.share){window.oldInvoke.apply(this,arguments)}else{var tempList=(that.__private__.share[type]||[]).concat(that.__private__.share["all"]||[]);var opts=bi&&bi.__private__.shareOptions;for(var o in opts){options[o]=opts[o]}var saveCbFn=cbFn;arguments[2]=function(){for(var it=0;it<tempList.length;it++){if(tempList[it]){tempList[it].apply(this,arguments)}}saveCbFn.apply(this,arguments)};window.oldInvoke.apply(this,arguments)}}catch(e){console.log(e)}};that.ready()};if(document.addEventListener){document.addEventListener("WeixinJSBridgeReady",readyHandler,false)}else{if(document.attachEvent){document.attachEvent("WeixinJSBridgeReady",readyHandler);document.attachEvent("onWeixinJSBridgeReady",readyHandler)}}};WeiXin.prototype.ready=function(fn){var api=this;if(fn){if(window.WeixinJSBridge){fn(api)}else{this.__private__.readyArr.push(fn)}}else{if(window.WeixinJSBridge){for(var i=0;i<this.__private__.readyArr.length;i++){this.__private__.readyArr[i](api)}}}};WeiXin.prototype.share=window.WEIXIN_API&&window.WEIXIN_API.Share||{timeline:function(options){WeixinJSBridge.on("menu:share:timeline",function(argv){WeixinJSBridge.invoke("shareTimeline",options,function(res){switch(res.err_msg){case"share_timeline:cancel":options.cancel&&options.cancel(res);break;case"share_timeline:confirm":case"share_timeline:ok":options.success&&options.success(res);break;case"share_timeline:fail":default:options.fail&&options.fail(res);break}})})},message:function(options){WeixinJSBridge.on("menu:share:appmessage",function(argv){WeixinJSBridge.invoke("sendAppMessage",options,function(res){switch(res.err_msg){case"send_app_msg:cancel":options.cancel&&options.cancel(res);break;case"send_app_msg:confirm":case"send_app_msg:ok":options.success&&options.success(res);break;case"send_app_msg:fail":default:options.fail&&options.fail(res);break}})})},weibo:function(options){WeixinJSBridge.on("menu:share:weibo",function(argv){WeixinJSBridge.invoke("shareWeibo",{url:options.link,content:options.desc},function(res){switch(res.err_msg){case"share_weibo:cancel":options.cancel&&options.cancel(res);break;case"share_weibo:confirm":case"share_weibo:ok":options.success&&options.success(res);break;case"share_weibo:fail":default:options.fail&&options.fail(res);break}})})},};WeiXin.prototype.share.all=function(options){bi.__private__.shareOptions=options};WeiXin.prototype.toolbar={show:function(){WeixinJSBridge.call("showToolbar")},hide:function(){WeixinJSBridge.call("hideToolbar")}};WeiXin.prototype.menu={show:function(){WeixinJSBridge.call("showOptionMenu")},hide:function(){WeixinJSBridge.call("hideOptionMenu")}};WeiXin.prototype.pay=function(){};WeiXin.prototype.viewImage=function(curSrc,srcList){if(!curSrc||!srcList||srcList.length==0){return}WeixinJSBridge.invoke("imagePreview",{"current":curSrc,"urls":srcList})};WeiXin.prototype.scanQRCode=function(callbacks){callbacks=callbacks||{};WeixinJSBridge.invoke("scanQRCode",{},function(res){switch(res.err_msg){case"scan_qrcode:ok":callbacks.success&&callbacks.success(res);break;default:callbacks.fail&&callbacks.fail(res);break}})};WeiXin.prototype.closeWindow=function(callbacks){callbacks=callbacks||{};WeixinJSBridge.invoke("closeWindow",{},function(res){switch(res.err_msg){case"close_window:ok":callbacks.success&&callbacks.success(res);break;default:callbacks.fail&&callbacks.fail(res);break}})};WeiXin.prototype.isInWeiXin=(function(e){return/MicroMessenger/i.test(navigator.userAgent)})();WeiXin.prototype.onShare=function(handlerFn,type){if(Object.prototype.toString.call(handlerFn)!="[object Function]"){return console.warn("BI._share-->arguments is not a function!")}var share=this.__private__.share=this.__private__.share||[];type=type||"all";share[type]=share[type]||[];share[type].push(handlerFn)};return new WeiXin()})();var util=(function(weixin){function BIUtil(){this.__private__={dataCache:{ip:"",province:"未知地区",city:"未知地区",startTime:Date.now(),loadTime:0},readyArr:[],isReady:false,isGetLocation:false};BIUtil._init.apply(this)}BIUtil._init=function(){var that=this;this.bindEvent(window,"load",function(e){var page_start_time=window.page_start_time;that.__private__.dataCache.loadTime=(Date.now()-that.__private__.dataCache.startTime)+600;that.__private__.isReady=true;that.ready()})};BIUtil.prototype.bindEvent=function(element,eventName,handler){if(element.attachEvent){element.attachEvent("on"+eventName,handler)}else{element.addEventListener(eventName,handler,false)}};BIUtil.prototype.unbindEvent=function(element,eventName,handler){if(element.detachEvent){element.detachEvent("on"+eventName,handler)}else{element.removeEventListener(eventName,handler,false)}};BIUtil.prototype.ready=function(fn){var pv=this.__private__;var fire=function(){for(var i=0;i<pv.readyArr.length;i++){pv.readyArr[i](this)}};if(fn){if(pv.isReady){!pv.isGetLocation?this.getIpLocation(function(){fn(this)}):fn(this)}else{pv.readyArr.push(fn)}}else{if(pv.isReady){!pv.isGetLocation?this.getIpLocation(fire):fire.call(this)}}};BIUtil.prototype.getIpLocation=function(cbFn){var pv=this.__private__;var dataCache=pv.dataCache;var that=this;this.getScript("http://pv.sohu.com/cityjson",function(e){dataCache.ip=returnCitySN.cip;if(returnCitySN.cname.indexOf("未能识别")>=0){dataCache.province=dataCache.city="未知地区"}else{if(returnCitySN.cname.indexOf("省")>=0){var regResult=(/(^.*[省])(.*$)/ig).exec(returnCitySN.cname);dataCache.province=regResult[2]?regResult[1]:regResult[0];dataCache.city=regResult[2]?regResult[2]:regResult[1]}else{dataCache.province=dataCache.city=returnCitySN.cname}}pv.isGetLocation=true;if(cbFn){cbFn.call(that)}})};BIUtil.prototype.getScript=function(url,callback,isJsonp){var script=document.createElement("script");script.type="text/javascript";if(callback){if(isJsonp){window.jsonp_callbacks=window.jsonp_callbacks||{};var callbackKey=["fn",Math.random().toString(16).replace("0.","")].join("_");window.jsonp_callbacks[callbackKey]=callback;url=this.addQueryString(url,{callback:"jsonp_callbacks."+callbackKey})}else{script.onload=callback}}script.src=url;document.head.appendChild(script)};BIUtil.prototype.formatUrlParams=function(data){var arr=[];for(var name in data){arr.push(encodeURIComponent(name)+"="+encodeURIComponent(data[name]))}return arr.join("&")};BIUtil.prototype.addQueryString=function(url,queryString){if(typeof(queryString)=="object"){queryString=this.formatUrlParams(queryString)}else{queryString=queryString.replace(/^\s+|\s+$/ig,"")}if(queryString){url=[url,(url.indexOf("?")>=0?"&":"?"),queryString].join("")}return url};BIUtil.prototype.ajax=function(options){};BIUtil.prototype.getCookie=function(key){var reg=new RegExp("(^|\\s+)"+key+"=([^;]*)(;|$)");var regResult=document.cookie.match(reg);if(regResult){return unescape(regResult[2])}else{return""}};BIUtil.prototype.setCookie=function(key,value,expires){var cookieItem=key+"="+escape(value);if(expires){if(typeof(expires)=="number"){expires=new Date(expires)}cookieItem+=";expires="+expires.toGMTString()}document.cookie=cookieItem};BIUtil.prototype.createGuid=function(){var guid="";do{guid+=Math.random().toString(16).replace("0.","")}while(guid.length<32);guid=[guid.substr(0,8),guid.substr(8,4),guid.substr(12,4),guid.substr(16,4),guid.substr(20,12)].join("-");return guid.toUpperCase()};BIUtil.prototype.getNetworkType=function(){var networkType="UNKNOWN";var result=(/NetType\/([^\s]*)/ig).exec(navigator.userAgent);if(result){networkType=result[1]}else{if(navigator.connection){var connection=navigator.connection;var type=connection["type"];for(var key in connection){if(key!="type"&&connection[key]==type){networkType=key}}}}return networkType};BIUtil.prototype.getToDayEndTime=function(){var endTime=new Date();endTime.setHours(23);endTime.setMinutes(59);endTime.setSeconds(59);endTime.setMilliseconds(999);return endTime.getTime()};BIUtil.prototype.getUID=function(){var uid=this.getCookie("BI_UID");if(!uid){uid=this.createGuid();var expires=new Date();expires.setFullYear(expires.getFullYear()+60);this.setCookie("BI_UID",uid,expires)}return uid};BIUtil.prototype.getUUID=function(){var uuid=this.getCookie("BI_UUID");if(!uuid){uuid=this.createGuid();var expires=this.getToDayEndTime();this.setCookie("BI_UUID",uuid,expires)}return uuid};BIUtil.prototype.getPVID=function(){if(!this.__private__.pvid){this.__private__.pvid=this.createGuid()}return this.__private__.pvid};BIUtil.prototype.getOS=function(){var name="Other";var version="";var ua=navigator.userAgent;var reg=/like Mac OS X|Android|Windows Phone|Symbian/ig;var regResult=reg.exec(ua);if(!regResult){reg=/Mac OS X|Windows NT|Linux/ig;regResult=reg.exec(ua)}if(!regResult){return name}else{switch(regResult[0]){case"like Mac OS X":name="iOS";reg=/(iPhone|iPod|iPad).*?OS\s*(\d*[\_|\.\d]*)/ig;break;case"Android":name="Android";reg=/(Android)\s*(\d*[\.\d]*)/ig;break;case"Windows Phone":name="Windows Phone";reg=/(Windows Phone)\s*[OS]*\s*(\d*[\.\d]*)/ig;break;case"Symbian":name="Symbian";reg=/(Symbian)\s*[OS]*\/*\s*(\d[\.\d]*)/ig;break;case"Mac OS X":name="OS X";reg=/(Mac OS X)\s*(\d*[\_|\.\d]*)/ig;break;case"Windows NT":name="Windows NT";reg=/(Windows NT)\s*(\d*[\_|\.\d]*)/ig;break;case"Linux":name="Linux";reg=/(Linux)\s*(i*\d*)/ig;break}regResult=reg.exec(ua);if(regResult&&regResult.length>=3){version=regResult[2].replace(/\_+/ig,".");reg=/^\d+\.*\d*/ig;regResult=reg.exec(version);if(regResult){version=regResult[0]}}}return[name,version].join(" ")};BIUtil.prototype.getBrowser=function(){var name="Other";var version="";var ua=navigator.userAgent;var reg=/MSIE|Chrome|Firefox|Opera|UCBrowser|UCWEB|Safari/ig;var regResult=reg.exec(ua);if(!regResult){return name}else{switch(regResult[0]){case"MSIE":name="IE";reg=/MS(IE)[\/|\s]+(\d*[\.\d]*)/ig;break;case"Chrome":name="Chrome";reg=/(Chrome)[\/|\s]+(\d*[\.\d]*)/ig;break;case"Firefox":name="Firefox";reg=/(Firefox)[\/|\s]+(\d*[\.\d]*)/ig;break;case"Safari":name="Safari";reg=/(Safari)[\/|\s]*(\d*[\.\d]*)/ig;break;case"Opera":name="Opera";reg=/(Opera)[\/|\s]+(\d*[\.\d]*)/ig;break;case"UCBrowser":name="UC";reg=/(UCBrowser)[\/|\s]+(\d*[\.\d]*)/ig;break;case"UCWEB":name="UC";reg=/(UCWEB)[\/|\s]*(\d*[\.\d]*)/ig;break}regResult=reg.exec(ua);if(regResult&&regResult.length>=3){version=regResult[2].replace(/\_+/ig,".");reg=/^\d+\.*\d*/ig;regResult=reg.exec(version);if(regResult){version=regResult[0]}}}return[name,version].join(" ")};BIUtil.prototype.getIP=function(){return this.__private__.dataCache.ip};BIUtil.prototype.getProvince=function(){return this.__private__.dataCache.province};BIUtil.prototype.getCity=function(){return this.__private__.dataCache.city};BIUtil.prototype.getDpi=function(e){return[window.screen.width,window.screen.height].join("*")};BIUtil.prototype.getRemainTime=function(){return Date.now()-this.__private__.dataCache.startTime};BIUtil.prototype.getSTime=function(){return this.__private__.dataCache.startTime};BIUtil.prototype.getLoadTime=function(){return this.__private__.dataCache.loadTime};return new BIUtil()})(weixin);var bi=(function(util,weixin){function BI(){this.__private__={postData:{},isReady:false,readyArr:[],isTest:true};BI._init.apply(this)}BI.prototype.util=util;BI.prototype.weixin=weixin;BI.prototype.ready=function(fn){if(fn){this.__private__.readyArr.push(fn);if(this.__private__.isReady){fn(this)}}else{if(this.__private__.isReady){for(var i=0;i<this.__private__.readyArr.length;i++){this.__private__.readyArr[i](this)}}}};BI._init=function(){var that=this;var domain=(/[^\.\s]+\.?(com|cn|net|org|gov|me|tv|biz|us|hkasia|co|info|name|tm|in|mobi|io|pro|la|ws|bz|vc|travel|mn|ag|tel|cm|wang|pw|cc|中国|香港|ac|bj|sh|hk|tj|cq|he|sx|nm|ln|jl|hl|js|zj|ah|fj|jx|sd|ha|hb|hn|gd|gx|hi|sc|gz|yn|xz|sn|gs|qh|nx|xj|tw|mo)(\.[^\.\s]+)*(?=$|\n|\?|\/|\#)/ig).exec(domain);domain=domain?domain[0]:domain;var ignoreDomains="|www.lightapp.cn|www.lightapp.me|www.lightapp.mobi|www.lightapp.net|www.lightapp.org|www.lightapp.so|www.lightapp.tv|www.liveapp.cn|www.liveapp.com|www.uliveapp.cn|www.uliveapp.com|www.uliveapp.org|www.uliveapp.net|www.linklive.com|www.livelink.com|";that.__private__.isTest=(domain==undefined||ignoreDomains.indexOf(domain+"|")<0);var onloadCallback=function(e){util.ready(function(e){BI._getBasicData.apply(that);that.__private__.isReady=true;that.ready();BI._post.apply(that)})};window.attachEvent&&window.attachEvent("onload",onloadCallback);window.addEventListener&&window.addEventListener("load",onloadCallback)};BI.prototype.push=function(serviceType,key,value){var serviceKey="service_"+serviceType;var biItem=this.__private__.postData[serviceKey];if(!biItem){biItem={opt:{service_type:serviceType},data:{}};this.__private__.postData[serviceKey]=biItem}biItem.data[key]=value};BI.prototype.get=function(serviceType,key){switch(arguments.length){case 1:return this.__private__.postData["service_"+serviceType];break;case 2:var biData=this.__private__.postData["service_"+serviceType];if(biData){return biData[key]}return undefined;break;default:throw"参数输入不正确！";break}};BI.prototype.post=function(){BI._post.apply(this,arguments)};BI._getBasicData=function(){this.push(1,"ua",navigator.userAgent);this.push(1,"browser",util.getBrowser());this.push(1,"os",util.getOS());this.push(1,"lang",navigator.language);this.push(1,"ip",util.getIP());this.push(1,"stime",util.getSTime());this.push(1,"link",document.location.href);this.push(1,"refer",document.referrer);this.push(1,"dpi",util.getDpi());this.push(1,"uuid",util.getUUID());this.push(1,"pvid",util.getPVID());this.push(1,"uid",util.getUID());this.push(1,"nettype",util.getNetworkType());this.push(1,"province",util.getProvince());this.push(1,"city",util.getCity());this.push(1,"lt",util.getLoadTime());return this.get(1)};BI._getBehaviorData=function(){this.push(2,"link",document.location.href);this.push(2,"ref",document.referrer);this.push(2,"lt",util.getLoadTime());this.push(2,"uid",util.getUID());this.push(2,"stime",util.getSTime());return this.get(2)};BI._getYunGoData=function(){this.push(3,"link",document.location.href);this.push(3,"ref",document.referrer);this.push(3,"uid",util.getUID());this.push(3,"ip",util.getIP());this.push(3,"province",util.getProvince());this.push(3,"city",util.getCity());this.push(3,"stime",util.getSTime());return this.get(3)};BI._post=function(serviceType,callback){if(typeof(serviceType)=="undefined"||arguments.length==0){for(var key in this.__private__.postData){if(!this.__private__.postData[key]){return console.warn("this.__private__.postData[key] is undefined"+key)}BI._post.apply(this,[this.__private__.postData[key].opt.service_type])}}else{var biData=this.get(serviceType);var temp;for(var key in biData.data){temp=biData.data[key];if(typeof(temp)=="string"&&temp.indexOf("http")==0){biData.data[key]=escape(temp)}}var url=["http://121.40.184.62?p=",JSON.stringify(biData)].join("");this.__private__.isTest=false;if(this.__private__.isTest){console.debug("BI Test:",url,biData)}else{util.getScript(url,callback)}delete this.__private__.postData["service_"+serviceType]}};BI._postBasicData=function(callback){BI._post.apply(this,[1,callback])};BI._postBehaviorData=function(callback){BI._post.apply(this,[2,callback])};return new BI()})(util,weixin);window.bi=bi})();